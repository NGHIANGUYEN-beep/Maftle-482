<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Drag & Drop Grid</title>
  <style>
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 80px);
      grid-template-rows: repeat(3, 80px);
      gap: 5px;
    }

    .cell {
      border: 1px solid #ccc;
      text-align: center;
      vertical-align: middle;
      background-color: #f4f4f4;
    }

    .item {
      padding: 10px;
      background-color: #9cf;
      cursor: move;
    }
  </style>
</head>
<body>

<div class="grid" id="grid">
  <!-- 3x3 = 9 cells -->
  <div class="cell" data-row="0" data-col="0" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
  <div class="cell" data-row="0" data-col="1" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
  <div class="cell" data-row="0" data-col="2" ondrop="drop(event)" ondragover="allowDrop(event)"></div>

  <div class="cell" data-row="1" data-col="0" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
  <div class="cell" data-row="1" data-col="1" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
  <div class="cell" data-row="1" data-col="2" ondrop="drop(event)" ondragover="allowDrop(event)"></div>

  <div class="cell" data-row="2" data-col="0" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
  <div class="cell" data-row="2" data-col="1" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
  <div class="cell" data-row="2" data-col="2" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
</div>

<br>

<div>
  <h3>Items to Drag</h3>
  <div id="items">
    <div class="item" draggable="true" ondragstart="drag(event)" id="coal" data-id="coal">Coal</div>
    <div class="item" draggable="true" ondragstart="drag(event)" id="stick" data-id="stick">Stick</div>
    <div class="item" draggable="true" ondragstart="drag(event)" id="oak_plank" data-id="oak_plank">Oak Plank</div>
  </div>
</div>

<br>
<button onclick="submitGrid()">Submit Guess</button>

<p id="response"></p>

<script>
  function allowDrop(ev) {
    ev.preventDefault();
  }

  function drag(ev) {
    ev.dataTransfer.setData("text", ev.target.id);
    ev.dataTransfer.effectAllowed = "copy";
  }

  function drop(ev) {
  ev.preventDefault();
  const data = ev.dataTransfer.getData("text");
  const original = document.getElementById(data);

  if (ev.target.classList.contains('cell')) {
    ev.target.innerHTML = '';

    const clone = original.cloneNode(true);
    clone.id = original.id + "-" + Math.random().toString(36).substr(2, 5); // Give it a unique ID
    clone.setAttribute("draggable", "true");
    clone.ondragstart = drag;
    clone.textContent = original.textContent;

    ev.target.appendChild(clone);
  }
}

function trimNullColumns(grid) {
  if (!grid.length) return grid;

  const numCols = grid[0].length;
  const colsToKeep = [];

  for (let col = 0; col < numCols; col++) {
    const hasNonNull = grid.some(row => row[col] !== null);
    if (hasNonNull) {
      colsToKeep.push(col);
    }
  }

  return grid.map(row => colsToKeep.map(col => row[col]));
}

function trimNullRows(grid) {
  return grid.filter(row => row.some(cell => cell !== null));
}

function submitGrid() {
  const rawGrid = Array.from({ length: 3 }, () => Array(3).fill(null));

  document.querySelectorAll('.cell').forEach(cell => {
    const row = cell.dataset.row;
    const col = cell.dataset.col;

    const item = cell.querySelector('.item');
    rawGrid[row][col] = item ? item.dataset.id : null;
  });

  // Trim null columns
 let trimmedGrid = trimNullRows(rawGrid);
trimmedGrid = trimNullColumns(trimmedGrid);

  // Send to server
  fetch('/submit-guess', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ grid: trimmedGrid })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById('response').textContent = data.message;
  })
  .catch(err => console.error('Error:', err));
}
</script>